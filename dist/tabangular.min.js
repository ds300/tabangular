(function(){var a,b,c,d,e,f,g,h,i,j,k={}.hasOwnProperty,l=function(a,b){function c(){this.constructor=a}for(var d in b)k.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};j=angular.module("tabangular",[]),j.run(function(){var a;return a=angular.element(document.head),a.ready(function(){return a.append("<style type='text/css'>.tabangular-hide {display: none;}</style>")})}),h=function(a,b){var c;return-1!==(c=a.indexOf(b))?(a.splice(c,1),!0):!1},g=function(a,b,c,d){var e;return null==(e=b[c])&&(e=[],b[c]=e),e.push(d),a.trigger("_attach",{event:c,callback:d}),function(){var b;return b=e.indexOf(d),-1!==b?(e.splice(b,1),a.trigger("_detach",{event:c,callback:d}),!0):!1}},b=function(){function a(){this._handlers={},this._onceHandlers={}}return a.prototype.on=function(a,b){return g(this,this._handlers,a,b)},a.prototype.one=function(a,b){return g(this,this._onceHandlers,a,b)},a.prototype.trigger=function(a,b){var c,d,e,f,g,h,i;if(null!=(e=this._handlers[a]))for(f=0,h=e.length;h>f;f++)(c=e[f])(b);if(null!=(d=this._onceHandlers[a]))for(g=0,i=d.length;i>g;g++)(c=d[g])(b);null!=d&&(d.length=0)},a}(),i={scope:!0,autoClose:!0},e=function(){function a(){this._tabTypes={},this._templateLoadCallbacks={},this._tabTypeFetcher=null,this.$get=["$http","$compile","$controller","$templateCache",function(a){return function(b,c,d,e){return new f(a,b,c,d,e)}}(this)]}return a.prototype.registerTabType=function(a,b){if(null!=this._tabTypes[a])throw new Error("duplicate tab type '"+a+"'");return this._tabTypes[a]=angular.extend({},i,b)},a.prototype.getTabType=function(a){var b;return b=$.Deferred(),null!=this._tabTypes[a]?b.resolve(this._tabTypes[a]):null!=this._tabTypeFetcher?this._tabTypeFetcher(b,a):b.resolve(null),b.promise()},a.prototype.setTabTypeFetcher=function(a){this._tabTypeFetcher=a},a}(),f=function(){function a(a,b,c,d,e){this.provider=a,this.$http=b,this.$compile=c,this.$controller=d,this.$templateCache=e}return a.prototype._compileElem=function(a,b,c){return null!=c&&this.$controller(c,{$scope:a._scope,Tab:a}),a._elem=this.$compile(b.trim())(a._scope),a._elem.addClass("tabangular-hide")},a.prototype._compileContent=function(a,b,c){return"string"==typeof a.type?this.provider.getTabType(a.type).done(function(d){return function(e){if(null==e)throw new Error("Unrecognised tab type: "+a.type);return a.type=e,d.__compileContent(a,b,c)}}(this)):void 0},a.prototype.__compileContent=function(a,b,c){var d,e,f,g,h;if(f=angular.extend({},i,a.type),f.autoClose&&a.on("close",function(){return a.close(!0)}),a._scope=f.scope?b.$new(!0):b,e=function(b){return function(d){return b._compileElem(a,d,f.controller),c()}}(this),null!=f.templateID)return e(document.getElementById(f.templateID).innerHTML);if(null!=f.templateString)return e(f.templateString);if(null!=(g=f.templateURL))return null!=(d=this.$templateCache.get(g))?e(d):null!=(h=this.provider._templateLoadCallbacks[g])?h.push(e):(this.provider._templateLoadCallbacks[g]=[e],this.$http.get(g).then(function(a){return function(b){var c,d,e,f,h;for(d=b.data,a.$templateCache.put(g,d),h=a.provider._templateLoadCallbacks[g],e=0,f=h.length;f>e;e++)(c=h[e])(d);return delete a.provider._templateLoadCallbacks[g]}}(this),function(b){return function(c){throw delete b.provider._templateLoadCallbacks[g],a.trigger("load_fail",c),new Error("Unable to load template from "+g)}}(this)));throw new Error("no template supplied")},a.prototype.newArea=function(a){return new d(this,a)},a}(),c=function(a){function b(a,c,d){this.area=a,this.type=c,this.options=d,b.__super__.constructor.call(this),this.loading=!0,this.loadingDeferred=!1,this.closed=!1,this.focused=!1,this._elem=null,this._scope=null}return l(b,a),b.prototype.deferLoading=function(){return this.loadingDeferred=!0},b.prototype.doneLoading=function(){return this.loading=!1,this.area._scope.$$phase||this.area._scope.$apply(),this.closed?void 0:this.trigger("loaded")},b.prototype.close=function(a){var b;if(this.closed)throw new Error("Tab already closed");return a?(h(this.area._tabs,this),h(this.area._focusStack,this),this.closed=!0,this.area._persist(),!this.loading&&(this._elem.remove(),this._scope!==this.area._scope&&this._scope.$destroy(),this._elem=this._scope=null,this.trigger("closed"),this.focused)?(0!==(b=this.area._focusStack.length)?this.area._focusStack[b-1].focus():0!==this.area._tabs.length&&this.area._tabs[0].focus(),this.focused=!1):void 0):this.trigger("close")},b.prototype.focus=function(){var a,b;if(this.loading)return this.on("loaded",function(a){return function(){return a.focus()}}(this));if(this.closed)throw new Error("Cannot focus closed tab");return this.focused?void 0:(0!==(b=this.area._focusStack.length)&&(a=this.area._focusStack[b-1],a._elem.addClass("tabangular-hide"),a.focused=!1),this.focused=!0,this._elem.removeClass("tabangular-hide"),h(this.area._focusStack,this),this.area._focusStack.push(this),this.area._persist(),this.trigger("focused"))},b}(b),a={id:null,persist:function(a){return null!=this.id?window.localStorage["tabangular:"+this.id]=a:void 0},getExisting:function(a){var b;return null!=this.id&&null!=(b=window.localStorage["tabangular:"+this.id])?a(b):void 0}},d=function(b){function d(b,c){var e;this._service=b,this.options=null!=c?c:{},d.__super__.constructor.call(this),this.options=angular.extend({},a,this.options),this._existingReady=!1,this._existingTabs=[],this._existingReadyQueue=[],"function"==typeof(e=this.options).getExisting&&e.getExisting(function(a){return function(b){var c,d,e,f;for(a._existingReady=!0,a._existingTabs=JSON.parse(b),f=a._existingReadyQueue,d=0,e=f.length;e>d;d++)(c=f[d])();return a._existingReadyQueue=[]}}(this)),this._tabs=[],this._focusStack=[],this._readyQueue=[],this._contentPane=null,this._scope=null}return l(d,b),d.prototype._persist=function(){var a;return"function"==typeof(a=this.options).persist?a.persist(JSON.stringify(this._tabs.map(function(a){return{type:a.type,options:a.options,active:!!a.focused}}))):void 0},d.prototype.handleExisting=function(a){var b,c,d,e,f;if(this._existingReady){for(f=this._existingTabs,d=0,e=f.length;e>d;d++)c=f[d],a(c)&&(b=this.load(c.type,c.options),c.active&&b.focus());this._persist()}else this._existingReadyQueue.push(function(b){return function(){return b.handleExisting(a)}}(this));return this},d.prototype._registerContentPane=function(a,b){var c,d,e,f;for(this._contentPane=b,this._scope=a,f=this._readyQueue,d=0,e=f.length;e>d;d++)(c=f[d])();return this._readyQueue=[]},d.prototype._createTab=function(a,b){var d;return d=new c(this,a,b),this._tabs.push(d),d},d.prototype.load=function(a,b){var c;return null==b&&(b={}),c=this._createTab(a,b),null!=this._contentPane?this._load(c):this._readyQueue.push(function(a){return function(){return a._load(c)}}(this)),this._persist(),c},d.prototype._load=function(a){return this._service._compileContent(a,this._scope,function(b){return function(){return b._contentPane.append(a._elem),a.trigger("dom_ready"),a.loadingDeferred?void 0:a.doneLoading()}}(this))},d.prototype.open=function(a,b){return this.load(a,b).focus()},d.prototype.list=function(){return this._tabs},d}(b),j.provider("Tabs",e),j.directive("tabContent",function(){return{scope:!1,restrict:"A",link:function(a,b){area._registerContentPane(a,b)}}})}).call(this);